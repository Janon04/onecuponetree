{% extends 'base.html' %}
{% block title %}Apply for {{ training.title }} | Barista Training{% endblock %}
{% block content %}
            <div class="container py-5" style="background-color: #fff; font-family: 'Times New Roman', Times, serif; font-size: 1.05rem;">
              <div class="row justify-content-center">
                <div class="col-lg-10 col-md-12">
                  <div class="card shadow border-0 rounded-4" style="background-color: #692e07; color: #fff;">
                    <div class="card-body p-5">
                      <h1 class="mb-3 text-center" style="font-family: 'Times New Roman', Times, serif; font-size: 2.2rem; color: #ffb366; text-shadow: 1px 1px 2px #2c1810; font-weight: bold; letter-spacing: 1px;">
                        ðŸ“‹ Barista Training Application Form
                      </h1>
                      <p class="lead text-center mb-4" style="color: #f5f5f5; font-size: 1.15rem; font-family: 'Times New Roman', Times, serif;">
                        Please fill in all required details. All information will be kept confidential and used only for training purposes.
                      </p>

                      {% if messages %}
                        {% for message in messages %}
                          <div id="training-success-alert" class="alert alert-success text-center fw-semibold" style="background-color:#d2691e; color:#fff; border:none;">
                            {{ message }}
                          </div>
                        {% endfor %}
                        <script>
                          setTimeout(function() {
                            var alertElem = document.getElementById('training-success-alert');
                            if (alertElem) { alertElem.style.display = 'none'; }
                          }, 5000);
                        </script>
                      {% endif %}

                      <form method="post" novalidate>
                        {% csrf_token %}
                        {% if form.errors %}
                          <div class="alert alert-danger">
                            <strong>There were errors in your submission:</strong>
                            <ul class="mb-0">
                            {% for field in form %}
                              {% for error in field.errors %}
                                <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                              {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                              <li>{{ error }}</li>
                            {% endfor %}
                            </ul>
                          </div>
                        {% endif %}

                        <!-- 1. Personal Information -->
                        <h4 class="mt-4 mb-3" style="color: #ffe0b3; text-shadow: 1px 1px 2px #2c1810; font-family: 'Times New Roman', Times, serif; font-size: 1.3rem; font-weight: bold;">1. Personal Information</h4>
                        <div class="row g-2">
                          <div class="col-md-8">{{ form.full_name.label_tag }}{{ form.full_name }}</div>
                          <div class="col-md-4">{{ form.date_of_birth.label_tag }}{{ form.date_of_birth }}</div>
                          <div class="col-md-4">{{ form.age.label_tag }}{{ form.age }}</div>
                          <div class="col-md-4">{{ form.gender.label_tag }}{{ form.gender }}</div>
                          <div class="col-md-4">{{ form.nationality.label_tag }}{{ form.nationality }}</div>
                          <div class="col-md-6">{{ form.id_number.label_tag }}{{ form.id_number }}</div>
                            <div class="col-md-6">{{ form.occupation.label_tag }}{{ form.occupation }}</div>
                        </div>
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                          const dobInput = document.getElementById('id_date_of_birth');
                          const ageInput = document.getElementById('id_age');
                          if (ageInput) {
                            ageInput.readOnly = true;
                          }
                          function calculateAge(dateString) {
                            if (!dateString) return '';
                            const today = new Date();
                            const dob = new Date(dateString);
                            let age = today.getFullYear() - dob.getFullYear();
                            const m = today.getMonth() - dob.getMonth();
                            if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                              age--;
                            }
                            return age >= 0 ? age : '';
                          }
                          if (dobInput && ageInput) {
                            dobInput.addEventListener('change', function() {
                              ageInput.value = calculateAge(dobInput.value);
                            });
                            if (dobInput.value) {
                              ageInput.value = calculateAge(dobInput.value);
                            }
                          }
                        });
                        </script>

                        <!-- 2. Contact Information -->
                        <h4 class="mt-4 mb-3" style="color: #ffe0b3; text-shadow: 1px 1px 2px #2c1810; font-family: 'Times New Roman', Times, serif; font-size: 1.3rem; font-weight: bold;">2. Contact Information</h4>
                        <div class="row g-2">
                          <div class="col-md-6">{{ form.phone.label_tag }}{{ form.phone }}</div>
                          <div class="col-md-6">{{ form.email.label_tag }}{{ form.email }}</div>
                          <div class="col-md-6">{{ form.country.label_tag }}{{ form.country }}</div>
                          <div class="col-md-6">{{ form.province.label_tag }}{{ form.province }}</div>
                          <div class="col-md-6">{{ form.district.label_tag }}{{ form.district }}</div>
                          <div class="col-md-6">{{ form.sector.label_tag }}{{ form.sector }}</div>
                          <div class="col-md-6">{{ form.cell.label_tag }}{{ form.cell }}</div>
                          <div class="col-md-6">{{ form.village.label_tag }}{{ form.village }}</div>
                        </div>

                        <!-- 3. Educational & Professional Background -->
                        <h4 class="mt-4 mb-3" style="color: #ffe0b3; text-shadow: 1px 1px 2px #2c1810; font-family: 'Times New Roman', Times, serif; font-size: 1.3rem; font-weight: bold;">3. Educational & Professional Background</h4>
                        <div class="row g-2">
                          <div class="col-md-6">{{ form.education_level.label_tag }}{{ form.education_level }}</div>
                          <div class="col-md-6">{{ form.occupation.label_tag }}{{ form.occupation }}</div>
                          <div class="card mb-3 border-0 shadow-sm">
                            <div class="card-header d-flex justify-content-between align-items-center" style="border-radius: 0.5rem 0.5rem 0 0; background: #713103; color: #fff;">
                              <span class="fw-semibold"><i class="fas fa-tools me-2"></i>Select Relevant Skills</span>
                              <button type="button" class="btn btn-sm" style="background: #a0522d; color: #fff; font-weight: 600; border-radius: 0.3rem;" data-bs-toggle="collapse" data-bs-target="#skills-experience-field" aria-expanded="false" aria-controls="skills-experience-field">Select Relevant Skills</button>
                            </div>
                            <div id="skills-experience-field" class="collapse">
                              <div class="card-body py-3" style="background: #f5e6da; border-radius: 0 0 0.5rem 0.5rem;">
                                <div class="row g-2">
                                  {% for checkbox in form.skills_experience %}
                                    <div class="col-md-6 col-12">
                                      <div class="form-check">
                                        {{ checkbox.tag }}
                                        <label class="form-check-label ms-1" for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
                                      </div>
                                    </div>
                                  {% endfor %}
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- 4. Training-Specific Information -->
                        <h4 class="mt-4 mb-3" style="color: #ffe0b3; text-shadow: 1px 1px 2px #2c1810; font-family: 'Times New Roman', Times, serif; font-size: 1.3rem; font-weight: bold;">4. Training-Specific Information</h4>
                        <div class="row g-2">
                          <div class="card mb-3 border-0 shadow-sm">
                            <div class="card-header d-flex justify-content-between align-items-center" style="border-radius: 0.5rem 0.5rem 0 0; background: #713103; color: #fff;">
                              <span class="fw-semibold"><i class="fas fa-question-circle me-2"></i>Why do you want to attend this training?</span>
                              <button type="button" class="btn btn-sm" style="background: #a0522d; color: #fff; font-weight: 600; border-radius: 0.3rem;" data-bs-toggle="collapse" data-bs-target="#motivation-reason-field" aria-expanded="false" aria-controls="motivation-reason-field">Select Motivation</button>
                            </div>
                            <div id="motivation-reason-field" class="collapse">
                              <div class="card-body py-3" style="background: #f5e6da; border-radius: 0 0 0.5rem 0.5rem;">
                                <div class="row g-2">
                                  <div class="col-12">
                                    {{ form.motivation.label_tag }}
                                    <div class="row g-2">
                                      {% for checkbox in form.motivation %}
                                        <div class="col-md-6 col-12">
                                          <div class="form-check">
                                            {{ checkbox.tag }}
                                            <label class="form-check-label ms-1" for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
                                          </div>
                                        </div>
                                      {% endfor %}
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="card mb-3 border-0 shadow-sm">
                            <div class="card-header d-flex justify-content-between align-items-center" style="border-radius: 0.5rem 0.5rem 0 0; background: #713103; color: #fff;">
                              <span class="fw-semibold"><i class="fas fa-lightbulb me-2"></i>What skills or knowledge do you expect to gain?</span>
                              <button type="button" class="btn btn-sm" style="background: #a0522d; color: #fff; font-weight: 600; border-radius: 0.3rem;" data-bs-toggle="collapse" data-bs-target="#expected-skills-field" aria-expanded="false" aria-controls="expected-skills-field">Select Expected Skills</button>
                            </div>
                            <div id="expected-skills-field" class="collapse">
                              <div class="card-body py-3" style="background: #f5e6da; border-radius: 0 0 0.5rem 0.5rem;">
                                <div class="row g-2">
                                  {% for checkbox in form.expected_skills %}
                                    <div class="col-md-6 col-12">
                                      <div class="form-check">
                                        {{ checkbox.tag }}
                                        <label class="form-check-label ms-1" for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
                                      </div>
                                    </div>
                                  {% endfor %}
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">{{ form.attended_similar.label_tag }} {{ form.attended_similar }}</div>
                          <div class="col-md-6">{{ form.attended_similar_details.label_tag }}{{ form.attended_similar_details }}</div>
                          <div class="col-md-6">{{ form.preferred_location.label_tag }}{{ form.preferred_location }}</div>
                          <div class="col-md-6">{{ form.availability.label_tag }}{{ form.availability }}</div>
                        </div>

                        <!-- 5. Additional Information -->
                        <h4 class="mt-4 mb-3" style="color: #ffe0b3; text-shadow: 1px 1px 2px #2c1810; font-family: 'Times New Roman', Times, serif; font-size: 1.3rem; font-weight: bold;">5. Additional Information</h4>
                        <div class="row g-2">
                          <div class="col-md-6">{{ form.emergency_contact_name.label_tag }}{{ form.emergency_contact_name }}</div>
                          <div class="col-md-6">{{ form.emergency_contact_relationship.label_tag }}{{ form.emergency_contact_relationship }}</div>
                          <div class="col-md-6">{{ form.emergency_contact_phone.label_tag }}{{ form.emergency_contact_phone }}</div>
                          <div class="col-md-6">{{ form.special_needs.label_tag }}{{ form.special_needs }}</div>
                          <div class="col-12">
                            <div class="card mb-3 border-0 shadow-sm">
                              <div class="card-header bg-warning bg-gradient d-flex justify-content-between align-items-center" style="cursor:pointer; border-radius: 0.5rem 0.5rem 0 0;" data-bs-toggle="collapse" data-bs-target="#languages-spoken-field" aria-expanded="false" aria-controls="languages-spoken-field">
                                <span class="fw-semibold text-dark"><i class="fas fa-language me-2"></i>Languages Spoken</span>
                                <span class="badge bg-light text-dark border border-warning">Select all that apply</span>
                              </div>
                              <div id="languages-spoken-field" class="collapse">
                                <div class="card-body py-3" style="background: #fffbe6; border-radius: 0 0 0.5rem 0.5rem;">
                                  <div class="row g-2">
                                    {% for checkbox in form.languages_spoken %}
                                      <div class="col-md-6 col-12">
                                        <div class="form-check">
                                          {{ checkbox.tag }}
                                          <label class="form-check-label ms-1" for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
                                        </div>
                                      </div>
                                    {% endfor %}
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- 6. Declaration & Consent -->
                        <h4 class="mt-4 mb-3" style="color: #ffe0b3; text-shadow: 1px 1px 2px #2c1810; font-family: 'Times New Roman', Times, serif; font-size: 1.3rem; font-weight: bold;">6. Declaration & Consent</h4>
                        <div class="form-check mb-2">
                          {{ form.confirm_information }} {{ form.confirm_information.label_tag }}
                        </div>
                        <div class="form-check mb-2">
                          {{ form.agree_participation }} {{ form.agree_participation.label_tag }}
                        </div>
                        <div class="row g-2">
                          <div class="col-md-8">{{ form.signature_name.label_tag }}{{ form.signature_name }}</div>
                          <div class="col-md-4">{{ form.signature_date.label_tag }}{{ form.signature_date }}</div>
                        </div>

                        <div class="d-grid mt-4">
                          <button type="submit" class="btn btn-lg btn-warning fw-bold" style="color: #2c1810;">Submit Application</button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <div class="mt-4">
                    <a href="{% url 'volunteers:barista_training_detail' training.pk %}" class="btn btn-outline-secondary">Back to Training Details</a>
                  </div>
                </div>
              </div>
            </div>

<style>
    .card .form-label { color: #ffffff !important; font-weight: 500; }
    .card .text-white { color: #ffffff !important; }
    .card h4, .card h5, .card h6 { color: #ffd700 !important; }
    .card .text-warning { color: #ffd700 !important; }
    .card .badge.bg-warning { background-color: #ffd700 !important; color: #692e07 !important; }
    .card .form-control, .card .form-select, .card textarea { background-color: rgba(255, 255, 255, 0.95) !important; color: #333 !important; border: 1px solid rgba(255, 255, 255, 0.3); }
    .card .form-control:focus, .card .form-select:focus { background-color: #ffffff !important; border-color: #ffd700; box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25); }
    .card .form-check-label { color: #ffffff !important; }
    .card .btn-warning { background-color: #ffd700 !important; border-color: #ffd700 !important; color: #692e07 !important; font-weight: 600; }
    .card .btn-warning:hover { background-color: #ffed4e !important; border-color: #ffed4e !important; }
</style>
{% endblock %}
