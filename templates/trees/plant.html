{% extends 'base.html' %}
{% load i18n static %}

{% block title %}{% trans "Plant a Tree" %}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">
            <div class="card shadow-lg border-0 rounded-4" style="background-color: #4b2e1a;">
                <div class="card-body p-4 p-md-5">
                    <!-- Header Section -->
                    <div class="text-center mb-4">
                        <h2 class="mb-2 text-warning fw-bold">
                            <i class="fas fa-tree me-2"></i>{% trans "Tree Planting Initiative" %}
                        </h2>
                        <p class="text-white mb-0">
                            {% trans "Join us in making the world greener! Fill out this form to take part in our tree-planting initiative." %}
                        </p>
                    </div>

                    <!-- Messages -->
                    {% if messages %}
                        {% for message in messages %}
                            <div id="plant-success-alert" class="alert alert-success text-center fw-semibold border-0" 
                                 style="background-color: #d2691e; color: #fff;">
                                {{ message }}
                            </div>
                        {% endfor %}
                        <script>
                            setTimeout(function() {
                                var alertElem = document.getElementById('plant-success-alert');
                                if (alertElem) { alertElem.style.display = 'none'; }
                            }, 5000);
                        </script>
                    {% endif %}

                    <!-- Main Form -->
                    <form method="post" enctype="multipart/form-data" novalidate class="text-white">
                        {% csrf_token %}
                        
                        {% if form.errors %}
                            <div class="alert alert-danger border-0 mb-4">
                                <strong>{% trans "There were errors in your submission:" %}</strong>
                                <ul class="mb-0 mt-2">
                                {% for field in form %}
                                    {% for error in field.errors %}
                                        <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                                    {% endfor %}
                                {% endfor %}
                                {% for error in form.non_field_errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                                </ul>
                            </div>
                        {% endif %}

                        <!-- 1. Tree Details -->
                        <div class="mb-4">
                            <h5 class="mb-3 text-warning border-bottom pb-2">
                                <span class="badge bg-warning text-dark me-2">1</span>
                                {% trans "Tree Details" %}
                            </h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="id_tree_type" class="form-label">{% trans "Tree Type" %}</label>
                                    {{ form.tree_type }}
                                    {% for error in form.tree_type.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6">
                                    <label for="id_quantity" class="form-label">{% trans "Quantity (Number of Trees)" %}</label>
                                    {{ form.quantity }}
                                    {% for error in form.quantity.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- 2. Location Details -->
                        <div class="mb-4">
                            <h5 class="mb-3 text-warning border-bottom pb-2">
                                <span class="badge bg-warning text-dark me-2">2</span>
                                {% trans "Location Details" %}
                            </h5>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label for="id_country" class="form-label">{% trans "Country" %}</label>
                                    {{ form.country }}
                                    {% for error in form.country.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4">
                                    <label for="id_province" class="form-label">{% trans "Province" %}</label>
                                    {{ form.province }}
                                    {% for error in form.province.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4">
                                    <label for="id_district" class="form-label">{% trans "District" %}</label>
                                    {{ form.district }}
                                    {% for error in form.district.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4">
                                    <label for="id_sector" class="form-label">{% trans "Sector" %}</label>
                                    {{ form.sector }}
                                    {% for error in form.sector.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4">
                                    <label for="id_cell" class="form-label">{% trans "Cell" %}</label>
                                    {{ form.cell }}
                                    {% for error in form.cell.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4">
                                    <label for="id_village" class="form-label">{% trans "Village" %}</label>
                                    {{ form.village }}
                                    {% for error in form.village.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6">
                                    <label for="id_latitude" class="form-label">{% trans "Latitude" %}</label>
                                    {{ form.latitude }}
                                    {% for error in form.latitude.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6">
                                    <label for="id_longitude" class="form-label">{% trans "Longitude" %}</label>
                                    {{ form.longitude }}
                                    {% for error in form.longitude.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- 3. Planting Date -->
                        <div class="mb-4">
                            <h5 class="mb-3 text-warning border-bottom pb-2">
                                <span class="badge bg-warning text-dark me-2">3</span>
                                {% trans "Planting Date" %}
                            </h5>
                            <div class="col-md-6">
                                <label for="id_planting_date" class="form-label">
                                    {% trans "When will/did you plant the tree(s)?" %}
                                </label>
                                {{ form.planting_date }}
                                {% for error in form.planting_date.errors %}
                                    <div class="text-warning small mt-1">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- 4. Contribution Type -->
                        <div class="mb-4">
                            <h5 class="mb-3 text-warning border-bottom pb-2">
                                <span class="badge bg-warning text-dark me-2">4</span>
                                {% trans "Contribution Type" %}
                            </h5>
                            <div>
                                <span class="form-label d-block mb-2">{{ form.contribution_type.label }}</span>
                                <div class="row g-3">
                                    {% for radio in form.contribution_type %}
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                {{ radio.tag }}
                                                <label class="form-check-label" for="{{ radio.id_for_label }}">
                                                    {{ radio.choice_label }}
                                                </label>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                                {% for error in form.contribution_type.errors %}
                                    <div class="text-warning small mt-1">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- 5. Your Details -->
                        <div class="mb-4">
                            <h5 class="mb-3 text-warning border-bottom pb-2">
                                <span class="badge bg-warning text-dark me-2">5</span>
                                {% trans "Your Details" %}
                            </h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="id_full_name" class="form-label">{% trans "Full Name" %}</label>
                                    {{ form.full_name }}
                                    {% for error in form.full_name.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6">
                                    <label for="id_contact" class="form-label">
                                        {% trans "Email Address / Phone Number" %}
                                    </label>
                                    {{ form.contact }}
                                    {% for error in form.contact.errors %}
                                        <div class="text-warning small mt-1">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- 6. Reason for Planting (Optional) -->
                        <div class="mb-4">
                            <h5 class="mb-3 text-warning border-bottom pb-2">
                                <span class="badge bg-warning text-dark me-2">6</span>
                                {% trans "Reason for Planting (Optional)" %}
                            </h5>
                            <div>
                                <label for="id_reason" class="form-label">{{ form.reason.label }}</label>
                                {{ form.reason }}
                                {% for error in form.reason.errors %}
                                    <div class="text-warning small mt-1">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- 7. Upload a Photo (Optional) -->
                        <div class="mb-4">
                            <h5 class="mb-3 text-warning border-bottom pb-2">
                                <span class="badge bg-warning text-dark me-2">7</span>
                                {% trans "Upload a Photo (Optional)" %}
                            </h5>
                            <div>
                                <label for="id_photo" class="form-label">{{ form.photo.label }}</label>
                                {{ form.photo }}
                                {% for error in form.photo.errors %}
                                    <div class="text-warning small mt-1">{{ error }}</div>
                                {% endfor %}
                                <div class="form-text text-white-50">
                                    {% trans "Accepted formats: JPG, PNG, GIF. Maximum file size: 5MB." %}
                                </div>
                            </div>
                        </div>

                        <!-- 8. Agreement/Consent -->
                        <div class="mb-4">
                            <h5 class="mb-3 text-warning border-bottom pb-2">
                                <span class="badge bg-warning text-dark me-2">8</span>
                                {% trans "Agreement/Consent" %}
                            </h5>
                            <div class="form-check">
                                {{ form.agreement }}
                                <label class="form-check-label" for="id_agreement">
                                    {% trans "I commit to ensuring the planted trees are cared for and maintained." %}
                                </label>
                                {% for error in form.agreement.errors %}
                                    <div class="text-warning small mt-1">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-warning btn-lg fw-bold py-3">
                                <i class="fas fa-seedling me-2"></i>{% trans "Join the Green Movement" %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="text-center mt-4">
                <p class="text-muted">
                    {% trans "Need help? Contact us at " %}
                    <a href="mailto:support@onecupinitiative.org" class="text-warning">support@onecupinitiative.org</a>
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Minimal CSS for form styling -->
<style>
    /* Form input styling */
    .form-control, .form-select {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
    }
    
    .form-control:focus, .form-select:focus {
        background-color: rgba(255, 255, 255, 0.15);
        border-color: #ffc107;
        color: white;
        box-shadow: 0 0 0 0.25rem rgba(255, 193, 7, 0.25);
    }
    
    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }
    
    /* Checkbox styling */
    .form-check-input {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .form-check-input:checked {
        background-color: #ffc107;
        border-color: #ffc107;
    }
    
    .form-check-input:focus {
        border-color: #ffc107;
        box-shadow: 0 0 0 0.25rem rgba(255, 193, 7, 0.25);
    }
    
    /* File input styling */
    input[type="file"]::file-selector-button {
        background-color: #ffc107;
        color: #212529;
        border: none;
        padding: 0.375rem 0.75rem;
        border-radius: 0.375rem;
        margin-right: 0.5rem;
    }
    
    input[type="file"]::file-selector-button:hover {
        background-color: #ffca2c;
    }
    
    /* Textarea styling */
    textarea.form-control {
        min-height: 100px;
        resize: vertical;
    }
    
    /* Section headings */
    h5.border-bottom {
        border-bottom-color: #ffc107 !important;
    }
    
    /* Badge styling */
    .badge.bg-warning {
        font-size: 0.875rem;
        padding: 0.35em 0.65em;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .card-body {
            padding: 1.5rem !important;
        }
        
        .btn-lg {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
        }
        
        h2 {
            font-size: 1.5rem;
        }
    }
</style>

<!-- Optional: JavaScript for form enhancements -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-hide success messages after 5 seconds
        const successAlert = document.getElementById('plant-success-alert');
        if (successAlert) {
            setTimeout(() => {
                successAlert.style.display = 'none';
            }, 5000);
        }
        
        // Add today's date as max for planting date
        const today = new Date().toISOString().split('T')[0];
        const plantingDateInput = document.getElementById('id_planting_date');
        if (plantingDateInput && plantingDateInput.type === 'date') {
            plantingDateInput.max = today;
        }
        
        // Initialize Bootstrap tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}