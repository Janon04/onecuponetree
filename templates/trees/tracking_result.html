{% extends "base.html" %}
{% load static i18n leaflet_tags %}

{% block extra_css %}
{% leaflet_css %}
<style>
    #tree-map {
        height: 400px;
        width: 100%;
    }
    .tree-detail-card {
        border-left: 5px solid var(--secondary-color);
    }
    .impact-badge {
        font-size: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4 tree-detail-card card-dynamic-hover">
                <div class="card-header bg-white">
                    <h2 class="mb-0">{% trans "Tree Details" %}</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h3>{{ tree.get_species_display }}</h3>
                            {# <p class="text-muted">ID: {{ tree.tree_id }}</p> #}
                            
                            <ul class="list-group list-group-flush mb-4">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {% trans "Planted Date" %}
                                    <span class="badge badge-primary">{{ tree.planted_date }}</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {% trans "Planted By" %}
                                    <span>{{ tree.planted_by.get_full_name|default:"Anonymous" }}</span>
                                </li>
                                {% if tree.farmer %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {% trans "Farmer" %}
                                    <span>{{ tree.farmer.user.get_full_name }}</span>
                                </li>
                                {% endif %}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            {% if tree.video %}
                            <video class="img-fluid rounded mb-3" controls style="width:100%;height:auto;max-height:220px;object-fit:cover;">
                                <source src="{{ tree.video.url }}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            {% elif tree.photo %}
                            <img src="{{ tree.photo.url }}" alt="Tree {{ tree.tree_id }}" class="img-fluid rounded mb-3">
                            {% endif %}
                            
                            <div class="alert alert-success">
                                <h4 class="alert-heading">{% trans "Environmental Impact" %}</h4>
                                <p>
                                    {% trans "This tree has offset approximately" %}
                                    <span class="font-weight-bold">{{ tree.co2_offset }} kg</span>
                                    {% trans "of CO₂ since it was planted." %}
                                </p>
                                <hr>
                                <p class="mb-0">
                                    {% trans "Thank you for contributing to a greener planet!" %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mb-4 card-dynamic-hover">
                <div class="card-header bg-white">
                    <h3 class="mb-0">{% trans "Tree Location" %}</h3>
                </div>
                <div class="card-body p-0">
                    {% leaflet_map "tree-map" callback="window.map_init" %}
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card mb-4 card-dynamic-hover">
                <div class="card-header bg-white">
                    <h3 class="mb-0">{% trans "Share Your Tree" %}</h3>
                </div>
                <div class="card-body">
                    <p>{% trans "Share your contribution with friends and family:" %}</p>
                    <div class="social-share-buttons">
                        <a href="#" class="btn btn-outline-primary btn-block mb-2">
                            <i class="fab fa-facebook-f mr-2"></i> {% trans "Share on Facebook" %}
                        </a>
                        <a href="#" class="btn btn-outline-info btn-block mb-2">
                            <i class="fab fa-twitter mr-2"></i> {% trans "Share on Twitter" %}
                        </a>
                        <a href="#" class="btn btn-outline-danger btn-block">
                            <i class="fab fa-instagram mr-2"></i> {% trans "Share on Instagram" %}
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="card card-dynamic-hover">
                <div class="card-header bg-white">
                    <h3 class="mb-0">{% trans "Your Impact" %}</h3>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-success text-white rounded-circle p-3 mr-3">
                            <i class="fas fa-leaf fa-2x"></i>
                        </div>
                        <div>
                            <h4 class="mb-0">1 {% trans "Tree Planted" %}</h4>
                            <p class="text-muted mb-0">{% trans "You're helping restore our planet" %}</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-primary text-white rounded-circle p-3 mr-3">
                            <i class="fas fa-coffee fa-2x"></i>
                        </div>
                        <div>
                            <h4 class="mb-0">1 {% trans "Farmer Supported" %}</h4>
                            <p class="text-muted mb-0">{% trans "You're empowering local communities" %}</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-center">
                        <div class="bg-warning text-white rounded-circle p-3 mr-3">
                            <i class="fas fa-globe-africa fa-2x"></i>
                        </div>
                        <div>
                            <h4 class="mb-0">{{ tree.co2_offset }} kg {% trans "CO₂ Offset" %}</h4>
                            <p class="text-muted mb-0">{% trans "You're fighting climate change" %}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% leaflet_js %}
<script>
    function map_init(map, options) {
        // Add base layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Add the tree location
        var treeLocation = [{{ tree.location.y }}, {{ tree.location.x }}];
        var marker = L.marker(treeLocation).addTo(map)
            .bindPopup("<b>{% trans 'Tree' %} {{ tree.tree_id }}</b><br>{{ tree.get_species_display }}<br>{% trans 'Planted on' %} {{ tree.planted_date }}");
        
        // Center map on the tree
        map.setView(treeLocation, 15);
    }
</script>
{% endblock %}